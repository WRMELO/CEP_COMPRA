{
  "task_id": "TASK_CEP_COMPRA_EXP_003A_MASTER_REGIME_V6_4STATE_PRICE_THEORY_CEPONLY_DUALINDEX_V1",
  "version": "v6",
  "master_index_ticker": "^BVSP",
  "validation_index_ticker": "^GSPC",
  "feature_constraints": {
    "no_endogenous_features": true,
    "feature_family": "CEP_MASTER_ONLY"
  },
  "price_theory_labeling_4state": {
    "lookback_days_for_peaks_troughs": 252,
    "thresholds": {
      "bear_drawdown": -0.2,
      "correction_drawdown": -0.1,
      "bull_rise": 0.2
    },
    "min_days": 5,
    "hysteresis": {
      "bear_exit_to_correction": -0.1,
      "correction_exit_to_neutral": -0.05,
      "bull_exit_to_neutral": 0.1
    }
  },
  "model": {
    "chosen_model": "logistic_regression",
    "formula_explicit": "p_bull = sigmoid(intercept + Σ(coef_i * z_i)); z_i=(x_i-mean_train_i)/std_train_i",
    "formula_parameters": {
      "intercept": 1.474165884658136,
      "coefficients": {
        "r_t": 0.30941914510927265,
        "mr_t": -0.09583183241001762,
        "xbar_n": -0.14866595492852797,
        "range_n": -0.11759880687380068,
        "z_r_60": -0.8616099448572482,
        "cep_i_below_lcl": 0.07604569498253666,
        "cep_i_above_ucl": -0.14025500393512283,
        "cep_mr_above_ucl": 0.16886810840453906,
        "cep_xbar_below_lcl": 0.061160276435720536,
        "cep_xbar_above_ucl": -0.15454307368270945,
        "cep_r_above_ucl": -0.4475646433700213,
        "dist_i_lcl": 0.3094191451092734,
        "dist_i_ucl": -0.30941914510927365,
        "dist_xbar_lcl": -0.14866595492852866,
        "dist_xbar_ucl": 0.1486659549285285,
        "stress_score": 0.011632996659793834,
        "upside_score": -0.1850693665502039
      }
    },
    "features_used": [
      "r_t",
      "mr_t",
      "xbar_n",
      "range_n",
      "z_r_60",
      "cep_i_below_lcl",
      "cep_i_above_ucl",
      "cep_mr_above_ucl",
      "cep_xbar_below_lcl",
      "cep_xbar_above_ucl",
      "cep_r_above_ucl",
      "dist_i_lcl",
      "dist_i_ucl",
      "dist_xbar_lcl",
      "dist_xbar_ucl",
      "stress_score",
      "upside_score"
    ],
    "normalization": {
      "mean_train": {
        "r_t": 0.0004024413249997942,
        "mr_t": 0.01762704335419882,
        "xbar_n": 0.00037529721379700096,
        "range_n": 0.031138273119572825,
        "z_r_60": -0.018885837624318867,
        "cep_i_below_lcl": 0.018847006651884702,
        "cep_i_above_ucl": 0.008869179600886918,
        "cep_mr_above_ucl": 0.036585365853658534,
        "cep_xbar_below_lcl": 0.015521064301552107,
        "cep_xbar_above_ucl": 0.004434589800443459,
        "cep_r_above_ucl": 0.038802660753880266,
        "dist_i_lcl": 0.0380764762886385,
        "dist_i_ucl": 0.039832215608111024,
        "dist_xbar_lcl": 0.020608139804373815,
        "dist_xbar_ucl": 0.022032928332770686,
        "stress_score": 0.0723946784922395,
        "upside_score": 0.012416851441241685
      },
      "std_train": {
        "r_t": 0.01831509964924883,
        "mr_t": 0.022195724975493523,
        "xbar_n": 0.008372359102286411,
        "range_n": 0.027744659131864635,
        "z_r_60": 1.029047659625146,
        "cep_i_below_lcl": 0.13598454688731582,
        "cep_i_above_ucl": 0.09375775836747653,
        "cep_mr_above_ucl": 0.18774151607732248,
        "cep_xbar_below_lcl": 0.12361294780280592,
        "cep_xbar_above_ucl": 0.06644489606994099,
        "cep_r_above_ucl": 0.1931243492475768,
        "dist_i_lcl": 0.01831509964924883,
        "dist_i_ucl": 0.01831509964924883,
        "dist_xbar_lcl": 0.00837235910228641,
        "dist_xbar_ucl": 0.008372359102286411,
        "stress_score": 0.34448880391805725,
        "upside_score": 0.11544251727000236
      }
    },
    "probability_calibration": "rank_pct monotônico"
  },
  "operational_thresholds": {
    "p_bull_enter": 0.6,
    "p_bull_exit": 0.59,
    "p_bear_enter": 0.35,
    "p_bear_exit": 0.36,
    "min_days": 5,
    "extra_band": 0.14
  },
  "operational_mapping_buy_levels": {
    "BULL": "BUY2",
    "BEAR": "BUY0",
    "CORRECAO": "BUY1",
    "NEUTRO": "BUY1"
  },
  "evaluation": {
    "calibration_bvsp": {
      "macro_f1_4state": 0.2747398464247276,
      "balanced_accuracy_4state": 0.3348321083388163,
      "switches_per_year_4state": 6.222222222222221,
      "class_distribution": {
        "CORRECAO": 924,
        "BULL": 463,
        "BEAR": 255,
        "NEUTRO": 221
      },
      "confusion_counts_4state": {
        "BULL": {
          "BULL": 226,
          "BEAR": 88,
          "CORRECAO": 663,
          "NEUTRO": 133
        },
        "BEAR": {
          "BULL": 12,
          "BEAR": 122,
          "CORRECAO": 14,
          "NEUTRO": 31
        },
        "CORRECAO": {
          "BULL": 118,
          "BEAR": 9,
          "CORRECAO": 108,
          "NEUTRO": 39
        },
        "NEUTRO": {
          "BULL": 107,
          "BEAR": 36,
          "CORRECAO": 139,
          "NEUTRO": 18
        }
      }
    },
    "validation_gspc_no_refit": {
      "macro_f1_4state": 0.29386553274687693,
      "balanced_accuracy_4state": 0.42371221604141573,
      "switches_per_year_4state": 4.734299516908212,
      "class_distribution": {
        "CORRECAO": 1194,
        "BEAR": 337,
        "BULL": 268,
        "NEUTRO": 64
      },
      "confusion_counts_4state": {
        "BULL": {
          "BULL": 223,
          "BEAR": 55,
          "CORRECAO": 980,
          "NEUTRO": 60
        },
        "BEAR": {
          "BULL": 7,
          "BEAR": 214,
          "CORRECAO": 0,
          "NEUTRO": 0
        },
        "CORRECAO": {
          "BULL": 0,
          "BEAR": 55,
          "CORRECAO": 64,
          "NEUTRO": 0
        },
        "NEUTRO": {
          "BULL": 38,
          "BEAR": 13,
          "CORRECAO": 150,
          "NEUTRO": 4
        }
      }
    },
    "neutral_or_correction_dominance": {
      "required_ratio": 0.5,
      "bvsp_ratio": 0.6146001073537305,
      "gspc_ratio": 0.6752549651100376,
      "pass": true
    },
    "states_reachable": {
      "bvsp": {
        "CORRECAO": 924,
        "BULL": 463,
        "BEAR": 255,
        "NEUTRO": 221
      },
      "gspc": {
        "CORRECAO": 1194,
        "BEAR": 337,
        "BULL": 268,
        "NEUTRO": 64
      },
      "pass": true
    }
  },
  "anti_leakage": {
    "decision_time_rule": "regime de D usa somente dados até D-1",
    "execution_time_rule": "sem uso de Close_D para decisão de D",
    "enforcement": "FAIL_IF_VIOLATED"
  }
}